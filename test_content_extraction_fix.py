#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
æµ‹è¯•å†…å®¹æå–ä¿®å¤æ•ˆæœ
éªŒè¯ä¿®å¤åçš„å†…å®¹æå–æ˜¯å¦èƒ½æ­£ç¡®è·å–full_content
"""

import json
from tools.llm_report_generator import _extract_content, _extract_text_from_dict
from tools.enhanced_report_generator import enhanced_report_generator
from tools.llm_report_generator import llm_report_generator

def test_content_extraction_fix():
    """æµ‹è¯•å†…å®¹æå–ä¿®å¤æ•ˆæœ"""
    print("ğŸ”§ æµ‹è¯•å†…å®¹æå–ä¿®å¤æ•ˆæœ")
    print("=" * 60)
    
    # æ¨¡æ‹ŸçœŸå®çš„æœç´¢ç»“æœæ•°æ®
    test_data = [
        {
            'title': 'è«¸è‘›äº®- ç¶­åŸºç™¾ç§‘ï¼Œè‡ªç”±çš„ç™¾ç§‘å…¨æ›¸',
            'link': 'https://zh.wikipedia.org/wiki/%E8%AF%B8%E8%91%9B%E4%BA%AE',
            'snippet': ' è«¸è‘›äº®æ˜¯æ¼¢å¸éš¸æ ¡å°‰è«¸è‘›è±å¾Œï¼›çˆ¶è¦ªè«¸è‘›çªï¼Œå­—å›è²¢ï¼Œæ¼¢æœ«ç‚ºæ³°å±±éƒ¡ä¸ã€‚ æ¼¢éˆå¸å…‰å’Œå››å¹´ï¼ˆ181å¹´ï¼‰ï¼Œè«¸è‘›äº®ç”Ÿæ–¼ç…çŠé™½éƒ½ã€‚ ä¸ä¹…æ¯è¦ªç« æ°å»ä¸–ï¼Œçˆ¶è¦ªçºŒå¨¶ã€‚ ä¸­å¹³äº”å¹´ï¼ˆ188å¹´ï¼‰ï¼Œè«¸è‘›äº®çš„çˆ¶\xa0... ',
            'full_content': '''è«¸è‘›äº®èœ€æ¼¢ä¸ç›¸ã€æ”¿æ²»å®¶ã€è»äº‹å®¶å‰ä»»ï¼šç„¡ï¼ˆé¦–ä»»ï¼‰ç¹¼ä»»ï¼šç„¡ï¼ˆå»¢é™¤ï¼‰æ¸…æ®¿è—æœ¬è«¸è‘›å­”æ˜åƒä¸ç›¸éŒ„å°šæ›¸äº‹åŠ é–‹åºœæ²»äº‹é¢†å¸éš¶æ ¡å°‰å…¼ç›Šå·ç‰§åœ‹å®¶æ±æ¼¢ â†’ èœ€æ¼¢æ™‚ä»£æ±æ¼¢æœ«å¹´è‡³ä¸‰åœ‹æ—¶æœŸä¸»å›åŠ‰å‚™ â†’ åŠ‰ç¦ªå§“è«¸è‘›åäº®å­—å­”æ˜è™Ÿè‡¥é¾å°çˆµæ­¦é„‰ä¾¯ï¼ˆèœ€æ±‰å°ï¼‰æ­¦å…´ç‹ï¼ˆä¸œæ™‹è¿½å°ï¼‰å®‰å›½ç‹ï¼ˆå‰èœ€è¿½å°ï¼‰å°åœ°æ­¦é„‰å‡ºèº«åœ°å¾å·ç…çŠéƒ¡ä¸–ç³»ç…çŠè«¸è‘›æ°å‡ºç”Ÿæ¼¢éˆå¸å…‰å’Œå››å¹´ï¼ˆ181å¹´ï¼‰æ±æ¼¢ç…çŠéƒ¡é™½éƒ½ç¸£ï¼ˆä»Šå±±æ±çœä¸´æ²‚å¸‚æ²‚å—ç¸£ï¼‰é€ä¸–èœ€æ¼¢å¾Œä¸»å»ºèˆˆåäºŒå¹´è¾²æ›†å…«æœˆï¼ˆ234å¹´ï¼‰äº”ä¸ˆåŸï¼ˆä»Šé™•è¥¿çœå²å±±ç¸£äº”ä¸ˆåŸé•‡ï¼‰è°¥å·å¿ æ­¦å¢“è‘¬æ¼¢ä¸­å®šè»å±±ç¥ å»Ÿæ­¦ä¾¯ç¥ è¦ªå±¬çˆ¶è¦ªè¯¸è‘›çªæ¯è¦ªç« æ°ç¹¼æ¯é¡§æ°æ­£å®¤é»ƒå¤«äººæ­£å®¤ä¹‹çˆ¶é»ƒæ‰¿å½¥æ­£å®¤ä¹‹æ¯è”¡æ°å…„å¼Ÿè«¸è‘›ç‘¾ã€è«¸è‘›å‡å§Šå¦¹ä½šåï¼ˆå¤«é¾å±±æ°‘ï¼‰ã€ä½šåï¼ˆå¤«è’¯ç¥ºï¼‰å­è«¸è‘›ç»é¤Šå­è«¸è‘›å–¬ï¼ˆè«¸è‘›ç‘¾éç¹¼ï¼‰å…¶ä»–è¦ªå±¬ä»çˆ¶ï¼šè«¸è‘›ç„å­«å…’ï¼šè«¸è‘›å°šï¼ˆèˆ‡çˆ¶è«¸è‘›ç»æˆ°æ­»æ–¼é­ç­èœ€ä¹‹æˆ˜ï¼‰ã€è«¸è‘›äº¬ï¼ˆä»•æ™‰å®˜è‡³æ±Ÿå·åˆºå²ï¼‰ å§»è¦ªï¼š èœ€æ¼¢ ç¹¼å­ï¼ˆç›£è­·å°è±¡ï¼‰ï¼šåŠ‰ç¦ªï¼ˆåŠ‰å‚™å­ï¼‰ç¹¼å…’åª³ï¼šæ•¬å“€çš‡åï¼ˆå¼µé£›é•·å¥³ï¼‰ã€å¼µçš‡åï¼ˆå¼µé£›æ¬¡å¥³ï¼‰ å…¶ä»–åŒè¼©ï¼šè²»ç¦•ï¼ˆè«¸è‘›ç»é€£è¥Ÿè²»æ‰¿ä¹‹çˆ¶ï¼‰ã€é—œèˆˆï¼ˆè«¸è‘›ç»é€£è¥Ÿé—œçµ±ä¹‹çˆ¶ï¼Œé—œç¾½ä¹‹å­ï¼‰ã€é¦¬è¶…ï¼ˆåŠ‰ç¦ªå¼ŸåŠ‰ç†å²³çˆ¶ï¼‰ã€åŠ‰å‚™ï¼ˆåŠ‰ç¦ªä¹‹çˆ¶ï¼‰ã€å¼µé£›ï¼ˆåŠ‰ç¦ªå²³çˆ¶ï¼‰ã€å¤ä¾¯éœ¸ï¼ˆåŠ‰ç¦ªå¾å…§èˆ…ï¼‰ æ™šè¼©ï¼šå§»ä¾„åŠ‰ç’¿ã€åŠ‰ç‘¤ã€åŠ‰ç®ã€åŠ‰ç“šã€åŠ‰è«¶ã€åŠ‰æ‚åŠåŠ‰ç’©ï¼ˆçš†ç‚ºåŠ‰ç¦ªå…’å­ï¼Œè«¸è‘›ç»å…§å…„/å¼Ÿï¼‰ã€åˆ˜èƒ¤åŠåŠ‰è¼¯ï¼ˆçš†ç‚ºåŠ‰ç¦ªå¼ŸåŠ‰ç†ä¹‹å­ï¼Œè«¸è‘›ç»å ‚å…§å…„/å¼Ÿï¼‰ã€è²»æ‰¿ã€é—œçµ±ï¼Œå§»ä¾„å¥³è²»æ°ï¼ˆåŠ‰ç’¿å¤ªå­å¦ƒï¼Œè²»ç¦•ä¹‹å¥³ï¼‰ æ±å³ å§»ä¼¯å­«æ¬Šï¼ˆå§»ä¼¯åŠ‰å‚™çš„å…§å…„ï¼Œå› å­«å’Œæ•…å…¼å§»ä¾„ï¼‰ å§»å¼Ÿå­«å’Œï¼ˆå…¼å¤–ä¾„å­«å©¿ï¼Œå­«å’Œå¤ªå­å¦ƒä¹‹å¤«ï¼‰ã€å­«ä¼‘ï¼ˆå­«æ¬Šå…­å­ï¼‰ã€å­«äº®ï¼ˆå­«æ¬Šä¸ƒå­ï¼‰ å§»ä¾„å­«çš“ï¼ˆå…¼æ›¾å¤–ä¾„å­«ï¼Œå­«å’Œé•·å­ï¼‰ æ›¹é­ é•·è¼©ï¼š å§»èˆ…å…¬æ›¹æ“ï¼ˆå§»èˆ…å¤ä¾¯éœ¸çš„å§¨ä¸ˆï¼‰ã€å¤ä¾¯æ·µï¼ˆå¤ä¾¯éœ¸çš„çˆ¶è¦ªï¼Œæ›¹æ“é€£è¥Ÿï¼‰ å§»æ—èˆ…å…¬å¤ä¾¯æƒ‡ï¼ˆå¤ä¾¯æ·µæ—å…„ï¼‰ å§»å¾è¡¨èˆ…å…¬æ›¹ä»ã€æ›¹ç´”ã€æ›¹æ´ªï¼ˆæ›¹æ“å¾å¼Ÿï¼‰ å§»å ‚èˆ…å¤ä¾¯å°šï¼ˆå¤ä¾¯éœ¸çš„å ‚å…„å¼Ÿï¼‰ å§»è¡¨èˆ…æ›¹ä¸•ã€æ›¹å½°ã€æ›¹æ¤åŠæ›¹ç†Šï¼ˆçš†ç‚ºå¤ä¾¯éœ¸çš„è¡¨å…„å¼Ÿï¼‰ã€æ›¹çœŸï¼ˆæ›¹æ“çš„æ—ä¾„ï¼‰ã€æ›¹ä¼‘ï¼ˆæ›¹æ“çš„æ—å­ï¼‰ å§»è¡¨å¼Ÿæ›¹å¡ï¼ˆæ›¹ä¸•ç¨å­ï¼‰åŠæ›¹çˆ½è«¸å…„å¼Ÿï¼ˆæ›¹çœŸè«¸å­ï¼‰ å§»è¡¨ä¾„æ›¹èŠ³ï¼ˆæ›¹å¡é¤Šå­ï¼‰ï¼›æ›¹é«¦åŠæ›¹å¥ï¼ˆçš†ç‚ºæ›¹å¡ç¹¼å­ï¼‰ è¥¿æ™‰ å§»å…„å¸é¦¬æ‡¿ï¼ˆå ‚ä¾„å¥³å©¿å¸é¦¬ä¼·ä¹‹çˆ¶ï¼‰ å§»ä¾„å¸é¦¬å¸«åŠå¸é¦¬æ˜­ï¼ˆçš†ç‚ºå¸é¦¬ä¼·ä¹‹å…„ï¼‰ å§»ä¾„å­«å¸é¦¬ç‚åŠå¸é¦¬æ”¸ç­‰ï¼ˆçš†ç‚ºå¸é¦¬æ˜­ä¹‹å­ï¼‰ å§»ä¾„å­«å¥³å©¿ç”„å¾·ï¼ˆå¸é¦¬å¸«åŠå¸é¦¬æ˜­å¥³å©¿ï¼Œæ›¹å¡å ‚å¦»èˆ…ï¼‰ æ±å³ ä¾„å…’ï¼šè¯¸è‘›æªï¼ˆé­å­™å³»æ—èª…ï¼‰ ä¾„å­«ï¼šè¯¸è‘›ç»°ã€è¯¸è‘›ç«¦ã€è¯¸è‘›å»º ä¾„å…’ï¼šè¯¸è‘›ä¹”ï¼ˆé¤Šå­ï¼‰ ä¾„å­«ï¼šè«¸è‘›æ”€ï¼ˆè‡ªèœ€æ¼¢è¿”å›æ±å³æ¢å¾©è«¸è‘›ç‘¾å¾Œäººèº«ä»½ï¼‰ æ›¾ä¾„å­«ï¼šè«¸è‘›é¡¯ï¼ˆèˆ‡è«¸è‘›äº¬é·å…¥è¥¿æ™‰ï¼‰ ä¾„å…’ï¼šè¯¸è‘›èï¼ˆé­å­™å³»æ—èª…ï¼‰ ä¾„å¥³ï¼šè«¸è‘›æ°ï¼ˆå¼µæ‰¿å¦»ï¼‰ å¤–ä¾„å­«å¼µéœ‡ï¼ˆé­å­™å³»æ—èª…ï¼‰ å¤–ä¾„å­«å¥³ å­«å’Œå¤ªå­å¦ƒ æ›¾å¤–ä¾„å­«å­«çš“æ®ºæ­»è‡ªèº«èƒå¼Ÿå­«ä¿Š æ›¾å¤–ä¾„å­«å¥³å­«æ°ï¼ˆé™¸æ™¯å¦»ï¼‰ è«¸è‘›æ°ï¼ˆé™¸æŠ—å¦»ï¼Œé™¸éœå…’åª³ï¼‰ æ›¾å¤–ä¾„å­«é™¸æ™¯ï¼ˆå­™çš“å¦¹å¤«ï¼‰ æ›¹é­åŠè¥¿æ™‰ å ‚å¼Ÿï¼šè«¸è‘›èª• å ‚ä¾„å…’ï¼šè¯¸è‘›é“ å ‚ä¾„å­«ï¼š è¯¸è‘›é ¤ è¯¸è‘›æ¢ å ‚æ›¾ä¾„å­«è¯¸è‘›ç”ã€è¯¸è‘›è™ªã€è«¸è‘›è¡¡ å ‚æ›¾ä¾„å­«å¥³è¯¸è‘›æ–‡å½ªï¼ˆå…ˆç‚ºåº¾äº®å…’åª³ï¼Œå†å«æ±Ÿè™¨ï¼‰ã€è¯¸è‘›æ°ï¼ˆç¾Šæ¥·å¦»ï¼Œç¾Šç¥œå’Œç¾Šå¾½ç‘œ(å¸é¦¬å¸«å¦»ï¼Œå¸é¦¬æ‡¿å…’åª³)çš„å ‚ä¾„å­™åª³ï¼‰ã€è¯¸è‘›æ–‡ç†Šï¼ˆè¬çŸ³å¦»ï¼Œè¬å®‰å¼Ÿåª³ï¼‰ å ‚ä¾„å¥³ï¼š è«¸è‘›æ°ï¼ˆå¸é¦¬ä¼·å¦»ã€å¸é¦¬æ‡¿å…’åª³ï¼‰ å ‚å¤–ä¾„å­«å¸é¦¬ç¹‡ å ‚æ›¾å¤–ä¾„å­«å¸é©¬ç¿ è¯¸è‘›æ° ï¼ˆç‹å‡Œå…’åª³ï¼Œå› ç‹å‡Œå›äº‚é­å¸é¦¬æ‡¿æ—èª…ï¼‰ å¤–ç”¥ï¼šé¾æ¸™ç¶“æ­· è»å¸«ä¸­éƒå°‡ è»å¸«å°‡è»ã€ç½²å·¦å°‡è»åºœäº‹ ç½²å¤§å¸é¦¬åºœäº‹ ä¸ç›¸å½•å°šä¹¦äº‹æš¨å‡èŠ‚ è‡ªè²¶ç‚ºå³å°‡è»ã€è¡Œä¸ç›¸äº‹ å¾©ç‚ºä¸ç›¸ã€åŠ é¢†å¸éš¶æ ¡å°‰ åŠ å°æ­¦é„‰ä¾¯ã€é–‹åºœæ²»äº‹ åŠ é ˜ç›Šå·ç‰§ è‘—ä½œã€Šè‰åºå°ã€‹ã€ã€Šç‚ºå¾Œå¸ä¼é­è©”ã€‹ã€ã€Šè«‹å®£å¤§è¡Œçš‡å¸éºè©”è¡¨ã€‹ã€ã€Šå‡ºå¸«è¡¨ã€‹ã€ã€Šè‡ªè¡¨å¾Œä¸»ã€‹ã€ã€Šæ­£è­°ã€‹ã€ã€Šçµ•ç›Ÿå¥½è­°ã€‹ã€ã€Šç‚ºæ³•æ­£ç­”æˆ–å•æ›¸ã€‹ã€ã€Šç­”é—œç¾½æ›¸ã€‹ã€ã€Šèª¡å­æ›¸ã€‹ã€ã€Šèª¡å¤–ç”¥æ›¸ã€‹ç­‰ è¯¸è‘›äº®ï¼ˆ181å¹´â€”234å¹´ï¼‰ï¼Œå­—å­”æ˜ï¼Œç…çŠéƒ¡é˜³éƒ½å¿ï¼ˆä»Šå±±æ±çœä¸´æ²‚å¸‚æ²‚å—ç¸£ï¼‰äººã€‚ä¸‰åœ‹æ™‚æœŸèœ€æ¼¢ï¼ˆå­£æ¼¢ï¼‰ä¸ç›¸:2902ï¼Œäº¦æ˜¯æ”¿æ²»å®¶ã€å†›äº‹å®¶ã€å‘æ˜å®¶åŠæ•£æ–‡å®¶ï¼Œæ›¾å‘æ˜æœ¨ç‰›æµé©¬ã€è¯¸è‘›è¿å¼©ç­‰ã€‚ä»–å¸¸è¢«å¾Œä¸–èªç‚ºæ˜¯æ™ºæ…§å’Œå¿ ç¾©çš„å…¸ç¯„ã€‚å…ˆç‚ºåŠ‰å‚™éº¾ä¸‹æ ¸å¿ƒå¹•åƒšï¼Œå¾Œä¸»åŠ‰ç¦…æ—©æœŸèœ€æ¼¢å¯¦éš›ä¸Šçš„æœ€é«˜é ˜å°äººã€‚ è«¸è‘›äº®å¹´è¼•æ™‚è‡ªæ¯”ç®¡ä»²ã€æ¨‚æ¯…ï¼Œäººç¨±ã€Œå§é¾™ã€:2902ã€‚è«¸è‘›äº®èˆ‡å¾å…ƒç›´ã€å´”å·å¹³ã€çŸ³å»£å…ƒã€å­Ÿå…¬å¨äº¤å¥½ï¼Œèˆ‡ã€Œé³³é››ã€é¾çµ±å¸«å‡ºåŒé–€é½Šåã€‚åŠ‰å‚™ä¸‰é¡§èŒ…å»¬å§‹è¦‹ä¹‹ï¼Œç‚ºåŠ‰å‚™ç•«æ“šèŠç›Šã€è¯åˆå­«æ¬Šã€æŠ—æ‹’æ›¹æ“ä¹‹ç­–ï¼Œè¼”ä½åŠ‰å‚™å–èŠå·ï¼Œå®šç›Šå·ï¼Œé‚èˆ‡æ›¹é­ã€å­«å³é¼è¶³è€Œä¸‰:2902ã€‚æ›¹ä¸•ä»£æ¼¢ï¼ŒåŠ‰å‚™ç¨±å¸æ–¼æˆéƒ½ï¼Œä»¥è«¸è‘›äº®ç‚ºä¸ç›¸:2902ã€‚åŠ‰å‚™æ­»ï¼Œè«¸è‘›äº®è¼”åŠ©å¾Œä¸»åŠ‰ç¦ªï¼Œä»¥ä¸ç›¸å°æ­¦ä¹¡ä¾¯ï¼Œå…¼é ˜ç›Šå·ç‰§:2902ã€‚ è«¸è‘›äº®æ•´å®˜åˆ¶ï¼Œä¿®æ³•åº¦ï¼Œå¿—å¾©ä¸­åŸ:2902ã€‚è«¸è‘›äº®æ”¹å–„ç¶“æ¿Ÿï¼Œä¼‘é¤Šç”Ÿæ¯ï¼Œæ‰“å£“ç›Šå·è±ªæ—ï¼Œå¹³å®šå—ä¸­å›äº‚ï¼Œæ§åˆ¶å—ä¸­ã€‚å±¢æ¬¡åŒ—ä¼ï¼Œèˆ‡é­ç›¸æ”»æˆ°:2902ã€‚å»ºèˆˆåäºŒå¹´ï¼Œè«¸è‘›äº®å’æ–¼äº”ä¸ˆåŸè»ä¸­ï¼Œå¹´äº”åå››ï¼Œè°¥ç‚ºå¿ æ­¦:2902ã€‚ã€Šä¸‰åœ‹å¿—Â·èœ€å¿—ã€‹æœ‰å‚³:2902ã€‚å¾Œä¸–æ™¯ä»°è¯¸è‘›äº®æ‰èƒ½å“æ ¼ï¼Œå¸¸å°Šå…¶ä¸ºæ­¦ä¾¯ã€è¯¸è‘›æ­¦ä¾¯ã€‚å¾Œæ°‘é–“å°èªªã€æˆ²æ›²è¬‚å…¶é€šæ›‰é™°é™½ï¼Œæ–™äº‹å¦‚ç¥:2902ã€‚"é èº¬ç›¡ç˜ã€æ­»è€Œå¾Œå·²"ï¼Œä»£è¡¨ä¸­å›½ä¼ ç»Ÿæ–‡åŒ–å¿ è‡£ä¸æ™ºè€…ã€‚æ˜ä»£ç¾…è²«ä¸­ã€Šä¸‰åœ‹æ¼”ç¾©ã€‹æ‰€åˆ»ç•«è€…ï¼Œæµå‚³çœ¾å£ï¼Œæœ€ç‚ºè‘—ç¨±:2902ã€‚æ¯›å®—å´—è¯„ã€Šä¸‰å›½æ¼”ä¹‰ã€‹å°†è¯¸è‘›äº®ç§°ä¸º"ä¸‰ç»"ä¸­çš„"æ™ºç»"ã€‚ è‘›æ°åŸä½åœ¨ç…çŠè«¸ç¸£ï¼Œå¾Œé·åˆ°ç…çŠé™½éƒ½ï¼Œé™½éƒ½å…ˆæœ‰è‘›æ°ï¼Œæ™‚äººç¨±è«¸ç¸£è‘›æ°ç‚ºè«¸è‘›ï¼Œå› ä¹‹ä»¥è«¸è‘›ç‚ºå§“:1232ã€‚ é»æ±æ–¹åœ¨ã€Šç´°èª¬ä¸‰åœ‹ã€‹ç¨±ï¼Œè«¸è‘›äº®é ç¥–æ˜¯å•†ä»£è‘›åœ‹åœ‹å›ï¼Œå°é‚‘åœ¨ä»Šæ²³å—çœæ±éƒ¨:2ã€‚è«¸è‘›äº®æ˜¯æ¼¢å¸éš¸æ ¡å°‰è«¸è‘›è±å¾Œï¼›çˆ¶è¦ªè«¸è‘›çªï¼Œå­—å›è²¢ï¼Œæ¼¢æœ«ç‚ºæ³°å±±éƒ¡ä¸:911ã€‚ æ¼¢éˆå¸å…‰å’Œå››å¹´ï¼ˆ181å¹´ï¼‰ï¼Œè«¸è‘›äº®ç”Ÿæ–¼ç…çŠé™½éƒ½:3ã€‚ä¸ä¹…æ¯è¦ªç« æ°å»ä¸–ï¼Œçˆ¶è¦ªçºŒå¨¶:3ã€‚ä¸­å¹³äº”å¹´ï¼ˆ188å¹´ï¼‰ï¼Œè«¸è‘›äº®çš„çˆ¶è¦ªè«¸è‘›çªå»ä¸–:3-4ã€‚ä¸€å®¶ç”Ÿæ´»ç”±å”çˆ¶è«¸è‘›ç„ä¾†ç…§æ–™:911ã€‚ è¢è¡“èˆ‡è«¸è‘›ç„æ˜¯ä¸–äº¤ï¼Œä»–è«‹è«¸è‘›ç„æ“”ä»»è±«ç« éƒ¡å¤ªå®ˆ:4ã€‚èˆˆå¹³å…ƒå¹´ï¼ˆ194å¹´ï¼‰ï¼Œè«¸è‘›ç„å¸¶è‘—è«¸è‘›äº®åŠå…¶å¼Ÿè«¸è‘›å‡ä»¥åŠä»–å€‘å…©å€‹å§å§éš¨åŒä¸Šä»»:4ã€‚è«¸è‘›ç‘¾ç•™å®¶ç…§é¡§ç¹¼æ¯:4ã€‚ä¹‹å¾Œè«¸è‘›ç‘¾å¸¶è‘—ç¹¼æ¯åˆ°æ±Ÿæ±é¿é›£ï¼Œå¾Œä¾†å‡ºä»•æ–¼å­«æ¬Šå¸³ä¸‹:4ã€‚ ä¹‹å¾Œæ¼¢æœæ›´é¸æœ±çš“ä»£è«¸è‘›ç„è·ä½:4ã€‚è«¸è‘›ç„ç´ èˆ‡èŠå·ç‰§åŠ‰è¡¨æœ‰èˆŠï¼Œå¾€ä¾é™„ä¹‹:4ã€‚è«¸è‘›ç„è¨±é…è«¸è‘›äº®å¤§å§äºˆä¸­å»¬è’¯ç¥ºï¼Œè¨±é…è«¸è‘›äº®äºŒå§äºˆé¾å¾·å…¬å…’å­é¾å±±æ°‘:5-6ã€‚å»ºå®‰äºŒå¹´ï¼ˆ197å¹´ï¼‰è«¸è‘›ç„æ­»ï¼Œç•¶æ™‚è«¸è‘›äº®è™›æ­²åä¸ƒæ­²:6ã€‚è«¸è‘›äº®èº¬è€•éš´ç•ï¼Œå¥½ç‚ºã€Šæ¢çˆ¶åŸã€‹ï¼›èº«é•·å…«å°ºï¼ˆç´„184å…¬åˆ†ï¼Œæ¼¢æ™‚ä¸€å°ºç´„ç‚º23ã€‚1å…¬åˆ†ï¼‰ï¼Œæ¯è‡ªå·±æ¯”ä½œæ–¼ç®¡ä»²ã€æ¨‚æ¯…ï¼Œç•¶æ™‚äººéƒ½ä¸åŒæ„ï¼›æƒŸæœ‰åšé™µå´”å·å¹³ã€ç©å·å¾åº¶èˆ‡è«¸è‘›äº®äº¤å¥½ï¼Œèªªæ˜¯ç¢ºå¯¦é€™æ¨£:911ã€‚ è¯¸è‘›äº®èˆ‡ç•¶æ™‚èŠå·åå£«å¸é¦¬å¾½ã€é¾å¾·å…¬ç­‰çµäº¤:911ã€‚ä¸‰åœ‹å¿—è¨»ã€Šè¥„é™½è¨˜ã€‹è¨˜è¼‰æ›°ï¼šé»ƒæ‰¿å½¥é«˜çˆ½é–‹åˆ—ï¼Œç‚ºæ²”å—åå£«ï¼Œè¬‚è«¸è‘›äº®ï¼šã€Œèå›æ“‡å©¦ï¼›èº«æœ‰é†œå¥³ï¼Œé»ƒé ­é»‘è‰²ï¼Œè€Œæ‰å ªç›¸é…ã€‚ï¼ˆè½èä½ æ­£è¦æŒ‘é¸å¦»å­ï¼›æˆ‘æœ‰ä¸€é†œå¥³å…’ï¼Œé»ƒé ­é«®ã€é»‘çš®è†šï¼Œä½†æ‰è¯å ªç›¸é…æ–¼ä½ ã€‚ï¼‰ã€ï¼›è«¸è‘›äº®ç­”æ‡‰ï¼Œå³è¿ï¼›æ™‚äººä»¥ç‚ºç¬‘æ¨‚ï¼Œé„‰é‡Œç‚ºä¹‹è«ºæ›°ï¼šã€Œè«ä½œå­”æ˜æ“‡å©¦ï¼Œæ­£å¾—é˜¿æ‰¿é†œå¥³ã€‚ï¼ˆä¸è¦åƒè«¸è‘›äº®é‚£æ¨£é¸è€å©†ï¼Œå¨¶äº†é»ƒæ‰¿å½¥çš„é†œå¥³å…’ã€‚ï¼‰ã€:929 æ˜äººä½œã€Šå­”æ˜å‡ºå±±åœ–ã€‹ å»ºå®‰å…­å¹´ï¼ˆ201å¹´ï¼‰ï¼Œæ›¹æ“æ—¢ç ´è¢ç´¹ï¼Œè‡ªå—é€²æ“ŠåŠ‰å‚™ï¼›åŠ‰å‚™æ´¾é£éº‹ç«ºã€å­«ä¹¾èˆ‡åŠ‰è¡¨ç›¸èï¼ŒåŠ‰è¡¨è‡ªéƒŠå¤–è¿æ¥ï¼Œä»¥ä¸Šè³“ä¹‹ç¦®ç›¸å¾…ï¼Œå¢ç›Šå…¶å…µé¦¬ï¼Œä½¿ä¹‹å±¯å…µæ–°é‡:876ã€‚åŠ‰å‚™å‘å¸é¦¬å¾½è«‹æ•™ä¸–äº‹ã€‚å¸é¦¬å¾½èªªï¼šã€Œæˆ‘é€™å„’ç”Ÿæ˜¯æ·ºä¿—å£«äººï¼Œæ€éº¼æœƒæ‡‚æ™‚å‹¢äº‹å‹™ã€‚çŸ¥é“æ™‚å‹¢äº‹å‹™çš„äººéƒ½æ˜¯è‹±ä¿Šè±ªå‚‘ã€‚åœ¨é€™åœ°æ–¹ï¼Œæœ‰è‡¥é¾ï¼ˆè¯¸è‘›äº®ï¼‰ã€é³³é››ï¼ˆé¾çµ±ï¼‰å…©äººã€‚ã€:913å¾åº¶è¦‹åŠ‰å‚™ï¼ŒåŠ‰å‚™å™¨é‡ï¼Œå¾åº¶å°åŠ‰å‚™èªªï¼šã€Œè«¸è‘›å­”æ˜ï¼Œæ˜¯è‡¥é¾ï¼ŒåŠ‰å°‡è»å¸Œæœ›è¦‹åˆ°å—ã€‚ã€ï¼›åŠ‰å‚™ç­”ï¼šã€Œä½ èˆ‡ä»–ä¸€èµ·éä¾†å§ã€‚ã€ï¼›å¾åº¶èªªï¼šã€Œè«¸è‘›äº®é€™å€‹äººä½ éœ€è¦è¦ªè‡ªå»è¦‹ä»–ï¼Œä¸èƒ½ç”±å…¶ä»–äººå»åšï¼Œé‚„å§”å±ˆå°‡è»æ‚¨åè»Šå»æ‹œè¨ªä»–ã€‚''',
            'content_length': 2995
        }
    ]
    
    print("ğŸ“‹ æµ‹è¯•æ•°æ®:")
    print(f"æ•°æ®ç±»å‹: {type(test_data)}")
    print(f"æ•°æ®é•¿åº¦: {len(test_data)}")
    print(f"ç¬¬ä¸€ä¸ªå…ƒç´ é”®: {list(test_data[0].keys())}")
    print(f"snippeté•¿åº¦: {len(test_data[0]['snippet'])}")
    print(f"full_contenté•¿åº¦: {len(test_data[0]['full_content'])}")
    print()
    
    # æµ‹è¯•ä¿®å¤åçš„å†…å®¹æå–
    print("ğŸ”§ æµ‹è¯•ä¿®å¤åçš„å†…å®¹æå–:")
    print("-" * 40)
    
    extracted_content = _extract_content(test_data)
    print(f"æå–çš„å†…å®¹é•¿åº¦: {len(extracted_content)}")
    print(f"æå–çš„å†…å®¹å‰200å­—ç¬¦: {extracted_content[:200]}")
    print()
    
    # éªŒè¯æ˜¯å¦æå–äº†full_content
    if len(extracted_content) > 1000:  # full_contentåº”è¯¥æœ‰2995å­—ç¬¦
        print("âœ… ä¿®å¤æˆåŠŸï¼ç°åœ¨æ­£ç¡®æå–äº†full_contentå­—æ®µ")
    else:
        print("âŒ ä¿®å¤å¤±è´¥ï¼ä»ç„¶åªæå–äº†snippetå­—æ®µ")
    
    print()
    
    # æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ
    print("ğŸ“ æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ:")
    print("-" * 40)
    
    # æµ‹è¯•LLMæŠ¥å‘Šç”Ÿæˆå™¨
    print("æµ‹è¯•LLMæŠ¥å‘Šç”Ÿæˆå™¨:")
    llm_result = llm_report_generator(
        content=test_data,
        format="markdown",
        max_words=500,
        title="è¯¸è‘›äº®èƒŒæ™¯æŠ¥å‘Š",
        topic="å†å²äººç‰©",
        style="professional"
    )
    
    if llm_result.get("status") == "success":
        llm_report = llm_result.get("data", {}).get("primary", {}).get("report_content", "")
        print(f"âœ… LLMæŠ¥å‘Šç”ŸæˆæˆåŠŸ")
        print(f"æŠ¥å‘Šé•¿åº¦: {len(llm_report)} å­—ç¬¦")
        print(f"æŠ¥å‘Šå‰300å­—ç¬¦: {llm_report[:300]}...")
    else:
        print(f"âŒ LLMæŠ¥å‘Šç”Ÿæˆå¤±è´¥: {llm_result.get('message')}")
    
    print()
    
    # æµ‹è¯•å¢å¼ºç‰ˆæŠ¥å‘Šç”Ÿæˆå™¨
    print("æµ‹è¯•å¢å¼ºç‰ˆæŠ¥å‘Šç”Ÿæˆå™¨:")
    enhanced_result = enhanced_report_generator(
        content=test_data,
        format="markdown",
        max_words=500,
        title="è¯¸è‘›äº®èƒŒæ™¯æŠ¥å‘Š",
        topic="å†å²äººç‰©",
        style="professional"
    )
    
    if enhanced_result.get("status") == "success":
        enhanced_report = enhanced_result.get("data", {}).get("primary", {}).get("report_content", "")
        print(f"âœ… å¢å¼ºç‰ˆæŠ¥å‘Šç”ŸæˆæˆåŠŸ")
        print(f"æŠ¥å‘Šé•¿åº¦: {len(enhanced_report)} å­—ç¬¦")
        print(f"æŠ¥å‘Šå‰300å­—ç¬¦: {enhanced_report[:300]}...")
    else:
        print(f"âŒ å¢å¼ºç‰ˆæŠ¥å‘Šç”Ÿæˆå¤±è´¥: {enhanced_result.get('message')}")

if __name__ == "__main__":
    test_content_extraction_fix() 