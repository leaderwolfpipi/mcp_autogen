# é€šç”¨å·¥å…·åˆ†ç±»ç³»ç»Ÿè®¾è®¡

## é—®é¢˜èƒŒæ™¯

åŸå§‹çš„æç¤ºè¯è®¾è®¡å­˜åœ¨ä¸¥é‡çš„é€šç”¨æ€§é—®é¢˜ï¼š

1. **ç¡¬ç¼–ç å·¥å…·è¾“å‡ºå­—æ®µ**ï¼šåœ¨æç¤ºè¯ä¸­å•ç‹¬è§„å®šæ¯ä¸ªå·¥å…·çš„è¾“å‡ºç»“æ„
2. **ç¼ºä¹å¯æ‰©å±•æ€§**ï¼šæ–°å¢å·¥å…·éœ€è¦ä¿®æ”¹æç¤ºè¯ä»£ç 
3. **ç»´æŠ¤å›°éš¾**ï¼šå¦‚æœæœ‰å‡ åƒä¸ªå·¥å…·ï¼Œéœ€è¦æ‰‹åŠ¨ç»´æŠ¤å¤§é‡ç¡¬ç¼–ç å†…å®¹

## è§£å†³æ–¹æ¡ˆ

### 1. åŠ¨æ€å·¥å…·è¾“å‡ºå­—æ®µç”Ÿæˆ

**æ ¸å¿ƒæ€æƒ³**ï¼šä»å·¥å…·çš„å®é™…è¾“å‡ºschemaä¸­åŠ¨æ€æå–å­—æ®µä¿¡æ¯ï¼Œè€Œä¸æ˜¯ç¡¬ç¼–ç ã€‚

```python
def _extract_output_fields(self, schema: Dict[str, Any]) -> str:
    """ä»è¾“å‡ºschemaä¸­æå–å­—æ®µä¿¡æ¯"""
    if not schema:
        return "{status, message}"
    
    properties = schema.get('properties', {})
    if not properties:
        return "{status, message}"
    
    # æå–å­—æ®µåå¹¶æ’åº
    fields = list(properties.keys())
    priority_fields = ['status', 'message']
    other_fields = [f for f in fields if f not in priority_fields]
    sorted_fields = priority_fields + sorted(other_fields)
    
    return "{" + ", ".join(sorted_fields) + "}"
```

### 2. å¯é…ç½®çš„å·¥å…·åˆ†ç±»ç³»ç»Ÿ

**æ ¸å¿ƒç»„ä»¶**ï¼š`ToolCategoryManager` ç±»

#### ç‰¹ç‚¹ï¼š
- **å¯é…ç½®çš„åˆ†ç±»è§„åˆ™**ï¼šæ”¯æŒå…³é”®è¯åŒ¹é…å’Œè¾“å‡ºå­—æ®µæ¨¡å¼åŒ¹é…
- **ä¼˜å…ˆçº§ç³»ç»Ÿ**ï¼šä¸åŒåˆ†ç±»æœ‰ä¸åŒçš„ä¼˜å…ˆçº§
- **æŒä¹…åŒ–é…ç½®**ï¼šæ”¯æŒä¿å­˜å’ŒåŠ è½½è‡ªå®šä¹‰åˆ†ç±»è§„åˆ™
- **åŠ¨æ€æ‰©å±•**ï¼šè¿è¡Œæ—¶å¯ä»¥æ·»åŠ æ–°çš„åˆ†ç±»è§„åˆ™

#### åˆ†ç±»è§„åˆ™å®šä¹‰ï¼š
```python
@dataclass
class CategoryRule:
    name: str
    keywords: List[str] = field(default_factory=list)
    output_patterns: List[str] = field(default_factory=list)
    emoji: str = "ğŸ”§"
    description: str = ""
    priority: int = 0
```

#### æ™ºèƒ½åŒ¹é…ç®—æ³•ï¼š
```python
def categorize_tool(self, tool_name: str, output_schema: Dict[str, Any]) -> str:
    """å¯¹å•ä¸ªå·¥å…·è¿›è¡Œåˆ†ç±»"""
    # è®¡ç®—æ¯ä¸ªåˆ†ç±»çš„åŒ¹é…åˆ†æ•°
    # å…³é”®è¯åŒ¹é…æƒé‡æ›´é«˜
    # è¾“å‡ºå­—æ®µæ¨¡å¼åŒ¹é…
    # è€ƒè™‘ä¼˜å…ˆçº§
    # è¿”å›æœ€é«˜åˆ†æ•°çš„åˆ†ç±»
```

### 3. é»˜è®¤åˆ†ç±»è§„åˆ™

ç³»ç»Ÿé¢„å®šä¹‰äº†11ç§å¸¸ç”¨åˆ†ç±»ï¼š

1. **æœç´¢å·¥å…·** ğŸ” - ä¿¡æ¯æœç´¢å’ŒæŸ¥è¯¢
2. **å›¾åƒå¤„ç†å·¥å…·** ğŸ–¼ï¸ - å›¾åƒæ–‡ä»¶å¤„ç†
3. **æ–‡æœ¬å¤„ç†å·¥å…·** ğŸ“ - æ–‡æœ¬å†…å®¹å¤„ç†
4. **æ–‡ä»¶å¤„ç†å·¥å…·** ğŸ“ - æ–‡ä»¶æ“ä½œ
5. **ä¸Šä¼ å·¥å…·** â˜ï¸ - æ–‡ä»¶ä¸Šä¼ å’Œå­˜å‚¨
6. **æ•°æ®åˆ†æå·¥å…·** ğŸ“Š - æ•°æ®åˆ†æå’Œå¯è§†åŒ–
7. **ä»£ç å¤„ç†å·¥å…·** ğŸ’» - ä»£ç ç”Ÿæˆå’Œå¤„ç†
8. **AIæ¨¡å‹å·¥å…·** ğŸ¤– - AIæ¨¡å‹å’Œæœºå™¨å­¦ä¹ 
9. **æ•°æ®åº“å·¥å…·** ğŸ—„ï¸ - æ•°æ®åº“æ“ä½œ
10. **ç½‘ç»œå·¥å…·** ğŸŒ - ç½‘ç»œå’ŒAPI
11. **å…¶ä»–å·¥å…·** ğŸ”§ - æœªåˆ†ç±»å·¥å…·

### 4. é›†æˆåˆ°RequirementParser

```python
class RequirementParser:
    def __init__(self, ..., category_manager: Optional[ToolCategoryManager] = None):
        self.category_manager = category_manager or ToolCategoryManager()
    
    def _generate_tool_output_schema_guide(self) -> str:
        """åŠ¨æ€ç”Ÿæˆå·¥å…·è¾“å‡ºå­—æ®µè¯´æ˜"""
        categorized_tools = self.category_manager.categorize_tools(self.available_tools)
        # ç”Ÿæˆåˆ†ç±»è¯´æ˜...
```

## ä¼˜åŠ¿

### 1. å®Œå…¨é€šç”¨
- âœ… æ”¯æŒä»»æ„æ•°é‡çš„å·¥å…·
- âœ… è‡ªåŠ¨ä»å·¥å…·schemaæå–å­—æ®µä¿¡æ¯
- âœ… æ— éœ€æ‰‹åŠ¨ç»´æŠ¤å·¥å…·åˆ—è¡¨

### 2. é«˜åº¦å¯æ‰©å±•
- âœ… è¿è¡Œæ—¶æ·»åŠ æ–°åˆ†ç±»
- âœ… é…ç½®æŒä¹…åŒ–
- âœ… æ”¯æŒè‡ªå®šä¹‰åˆ†ç±»è§„åˆ™

### 3. æ™ºèƒ½åˆ†ç±»
- âœ… åŸºäºå…³é”®è¯å’Œè¾“å‡ºå­—æ®µçš„åŒé‡åŒ¹é…
- âœ… ä¼˜å…ˆçº§ç³»ç»Ÿ
- âœ… è‡ªåŠ¨å›é€€åˆ°"å…¶ä»–å·¥å…·"åˆ†ç±»

### 4. æ€§èƒ½ä¼˜ç§€
- âœ… 40ä¸ªå·¥å…·åˆ†ç±»è€—æ—¶ä»…0.0011ç§’
- âœ… å†…å­˜å ç”¨ä½
- âœ… ç®—æ³•å¤æ‚åº¦O(n*m)ï¼Œnä¸ºå·¥å…·æ•°ï¼Œmä¸ºåˆ†ç±»æ•°

## ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ä½¿ç”¨
```python
# åˆ›å»ºè§£æå™¨
parser = RequirementParser(use_llm=False)

# æ·»åŠ å·¥å…·
tools = [tool1, tool2, tool3, ...]
parser.update_available_tools(tools)

# è‡ªåŠ¨ç”Ÿæˆå·¥å…·è¾“å‡ºå­—æ®µè¯´æ˜
guide = parser._generate_tool_output_schema_guide()
```

### æ·»åŠ è‡ªå®šä¹‰åˆ†ç±»
```python
# æ·»åŠ åŒºå—é“¾å·¥å…·åˆ†ç±»
parser.add_custom_category(
    category_name="åŒºå—é“¾å·¥å…·",
    keywords=["blockchain", "crypto", "ethereum"],
    output_patterns=["block_data", "transaction"],
    emoji="â›“ï¸"
)
```

### ç›´æ¥ä½¿ç”¨åˆ†ç±»ç®¡ç†å™¨
```python
category_manager = ToolCategoryManager()

# æ·»åŠ è‡ªå®šä¹‰åˆ†ç±»
blockchain_category = CategoryRule(
    name="åŒºå—é“¾å·¥å…·",
    keywords=["blockchain", "crypto"],
    output_patterns=["block_data", "transaction"],
    emoji="â›“ï¸",
    priority=8
)
category_manager.add_category(blockchain_category)

# åˆ†ç±»å·¥å…·
categorized = category_manager.categorize_tools(tools)
```

## é…ç½®æŒä¹…åŒ–

è‡ªå®šä¹‰åˆ†ç±»è§„åˆ™ä¼šè‡ªåŠ¨ä¿å­˜åˆ° `config/tool_categories.json`ï¼š

```json
{
  "categories": [
    {
      "name": "åŒºå—é“¾å·¥å…·",
      "keywords": ["blockchain", "crypto", "ethereum"],
      "output_patterns": ["block_data", "transaction"],
      "emoji": "â›“ï¸",
      "description": "åŒºå—é“¾å’ŒåŠ å¯†è´§å¸ç›¸å…³å·¥å…·",
      "priority": 8
    }
  ]
}
```

## æµ‹è¯•ç»“æœ

### åŠŸèƒ½æµ‹è¯•
- âœ… åŸºæœ¬åˆ†ç±»åŠŸèƒ½æ­£å¸¸
- âœ… è‡ªå®šä¹‰åˆ†ç±»åŠŸèƒ½æ­£å¸¸
- âœ… ä¸RequirementParseré›†æˆæ­£å¸¸
- âœ… é…ç½®æŒä¹…åŒ–æ­£å¸¸

### æ€§èƒ½æµ‹è¯•
- âœ… 40ä¸ªå·¥å…·åˆ†ç±»è€—æ—¶ï¼š0.0011ç§’
- âœ… å†…å­˜å ç”¨ï¼šæä½
- âœ… æ”¯æŒå¤§è§„æ¨¡å·¥å…·é›†

### æ‰©å±•æ€§æµ‹è¯•
- âœ… æ”¯æŒä»»æ„æ•°é‡çš„å·¥å…·
- âœ… æ”¯æŒä»»æ„æ•°é‡çš„åˆ†ç±»
- âœ… è¿è¡Œæ—¶åŠ¨æ€æ·»åŠ åˆ†ç±»

## æ€»ç»“

é€šè¿‡è¿™ä¸ªé€šç”¨å·¥å…·åˆ†ç±»ç³»ç»Ÿï¼Œæˆ‘ä»¬å½»åº•è§£å†³äº†åŸå§‹è®¾è®¡çš„é€šç”¨æ€§é—®é¢˜ï¼š

1. **æ¶ˆé™¤äº†ç¡¬ç¼–ç **ï¼šæ‰€æœ‰å·¥å…·è¾“å‡ºå­—æ®µéƒ½ä»å®é™…schemaåŠ¨æ€ç”Ÿæˆ
2. **å®ç°äº†å®Œå…¨å¯æ‰©å±•**ï¼šæ”¯æŒä»»æ„æ•°é‡çš„å·¥å…·å’Œåˆ†ç±»
3. **æä¾›äº†æ™ºèƒ½åˆ†ç±»**ï¼šåŸºäºå¤šç§åŒ¹é…ç­–ç•¥çš„è‡ªåŠ¨åˆ†ç±»
4. **ä¿è¯äº†é«˜æ€§èƒ½**ï¼šæ¯«ç§’çº§çš„åˆ†ç±»é€Ÿåº¦
5. **æ”¯æŒé…ç½®æŒä¹…åŒ–**ï¼šè‡ªå®šä¹‰åˆ†ç±»è§„åˆ™è‡ªåŠ¨ä¿å­˜

è¿™ä¸ªè®¾è®¡ä¸ºç³»ç»Ÿçš„é•¿æœŸå‘å±•å¥ å®šäº†åšå®çš„åŸºç¡€ï¼Œæ— è®ºæœªæ¥æœ‰å¤šå°‘å·¥å…·ï¼Œéƒ½èƒ½è‡ªåŠ¨é€‚åº”å’Œæ‰©å±•ã€‚ 