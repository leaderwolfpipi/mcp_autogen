<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mermaid æµ‹è¯•</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            margin: 20px;
            background: #f8fafc;
        }
        
        .mermaid-container {
            width: 100%;
            margin: 16px 0;
            padding: 20px;
            background: #f8fafc;
            border-radius: 8px;
            overflow: visible;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 300px;
            border: 1px solid #e2e8f0;
        }
        
        .mermaid-diagram {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: visible;
        }
        
        .mermaid-diagram svg {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto;
            overflow: visible !important;
            background: transparent;
        }
        
        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes dashFlow {
            0% { stroke-dashoffset: 0; }
            100% { stroke-dashoffset: -12; }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }
        
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); opacity: 0.8; }
            70% { transform: scale(0.9); opacity: 0.9; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .mermaid-diagram svg path[stroke-dasharray] {
            stroke-dasharray: 8 4 !important;
            animation: dashFlow 2s linear infinite !important;
        }
    </style>
</head>
<body>
    <h1>Mermaid å›¾è¡¨æµ‹è¯•</h1>
    
    <div class="mermaid-container">
        <div class="mermaid-diagram" id="test-diagram">
            <!-- Mermaid å›¾è¡¨å°†åœ¨è¿™é‡Œæ¸²æŸ“ -->
        </div>
    </div>
    
    <button onclick="renderDiagram()">æ¸²æŸ“å›¾è¡¨</button>
    <button onclick="updateDiagram()">æ›´æ–°çŠ¶æ€</button>
    
    <script>
        // åˆå§‹åŒ– Mermaid
        mermaid.initialize({
            startOnLoad: false,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis',
                padding: 30,
                nodeSpacing: 50,
                rankSpacing: 60
            },
            themeVariables: {
                fontSize: '14px',
                fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif',
                primaryColor: '#e0e7ff',
                primaryTextColor: '#1e40af',
                primaryBorderColor: '#3b82f6',
                lineColor: '#6b7280',
                secondaryColor: '#f0f9ff',
                tertiaryColor: '#f8fafc'
            }
        });
        
        let currentState = 0;
        
        const diagrams = [
            // åˆå§‹çŠ¶æ€
            `graph TD
                User["ğŸ‘¤ ç”¨æˆ·è¾“å…¥"] --> LLM["ğŸ§  LLMåˆ†æ"]
                LLM -.->|"â³ ç­‰å¾…è®¡åˆ’"| Waiting["â³ ç­‰å¾…æ‰§è¡Œè®¡åˆ’..."]
                
                classDef userNode fill:#e0e7ff,stroke:#3b82f6,stroke-width:2px,color:#1e40af
                classDef llmNode fill:#f0f9ff,stroke:#0ea5e9,stroke-width:2px,color:#0c4a6e
                classDef waitingNode fill:#f8fafc,stroke:#e2e8f0,stroke-width:2px,color:#64748b
                
                class User userNode
                class LLM llmNode
                class Waiting waitingNode`,
            
            // æ‰§è¡Œä¸­çŠ¶æ€
            `graph TD
                User["ğŸ‘¤ ç”¨æˆ·è¾“å…¥"] --> LLM["ğŸ§  LLMåˆ†æ"]
                LLM -.->|"ğŸ”„ æ­£åœ¨æ‰§è¡Œ"| Tool1["ğŸ”„ æœç´¢ç½‘é¡µ..."]
                Tool1 -.->|"â³ ç­‰å¾…"| Tool2["â³ åˆ†ææ•°æ®..."]
                Tool2 -.->|"â³ ç­‰å¾…æ€»ç»“"| LLMSummary["ğŸ§  LLMæ€»ç»“"]
                LLMSummary -.->|"â³ ç­‰å¾…è¾“å‡º"| Output["ğŸ“‹ æœ€ç»ˆè¾“å‡º"]
                
                classDef userNode fill:#e0e7ff,stroke:#3b82f6,stroke-width:2px,color:#1e40af
                classDef llmNode fill:#f0f9ff,stroke:#0ea5e9,stroke-width:2px,color:#0c4a6e
                classDef pendingTool fill:#f8fafc,stroke:#e2e8f0,stroke-width:2px,color:#64748b
                classDef runningTool fill:#dbeafe,stroke:#3b82f6,stroke-width:3px,color:#1e40af
                classDef outputNode fill:#f3e8ff,stroke:#8b5cf6,stroke-width:2px,color:#7c3aed
                
                class User userNode
                class LLM,LLMSummary llmNode
                class Output outputNode
                class Tool1 runningTool
                class Tool2 pendingTool`,
            
            // å®ŒæˆçŠ¶æ€
            `graph TD
                User["ğŸ‘¤ ç”¨æˆ·è¾“å…¥"] --> LLM["ğŸ§  LLMåˆ†æ"]
                LLM -->|"âœ… å·²å®Œæˆ"| Tool1["âœ… æœç´¢ç½‘é¡µ"]
                Tool1 -->|"âœ… å®Œæˆ"| Tool2["âœ… åˆ†ææ•°æ®"]
                Tool2 -->|"ğŸ“‹ ç”Ÿæˆç»“æœ"| LLMSummary["ğŸ§  LLMæ€»ç»“"]
                LLMSummary -->|"ğŸ“¤ è¾“å‡ºç»“æœ"| Output["ğŸ“‹ æœ€ç»ˆè¾“å‡º"]
                
                classDef userNode fill:#e0e7ff,stroke:#3b82f6,stroke-width:2px,color:#1e40af
                classDef llmNode fill:#f0f9ff,stroke:#0ea5e9,stroke-width:2px,color:#0c4a6e
                classDef successTool fill:#dcfce7,stroke:#16a34a,stroke-width:2px,color:#15803d
                classDef outputNode fill:#f3e8ff,stroke:#8b5cf6,stroke-width:2px,color:#7c3aed
                
                class User userNode
                class LLM,LLMSummary llmNode
                class Output outputNode
                class Tool1,Tool2 successTool`
        ];
        
        async function renderDiagram() {
            const diagramEl = document.getElementById('test-diagram');
            const diagramCode = diagrams[currentState];
            
            try {
                const { svg } = await mermaid.render('test-svg', diagramCode);
                diagramEl.innerHTML = svg;
                
                // æ·»åŠ åŠ¨ç”»æ•ˆæœ
                setTimeout(() => {
                    const svgElement = diagramEl.querySelector('svg');
                    if (svgElement) {
                        addAnimations(svgElement);
                    }
                }, 100);
                
            } catch (error) {
                console.error('æ¸²æŸ“å¤±è´¥:', error);
                diagramEl.innerHTML = `<p style="color: red;">æ¸²æŸ“å¤±è´¥: ${error.message}</p>`;
            }
        }
        
        function updateDiagram() {
            currentState = (currentState + 1) % diagrams.length;
            renderDiagram();
        }
        
        function addAnimations(svgElement) {
            // ä¸ºè™šçº¿è·¯å¾„æ·»åŠ åŠ¨ç”»
            const allPaths = svgElement.querySelectorAll('path');
            allPaths.forEach(path => {
                if (path.style.strokeDasharray || path.getAttribute('stroke-dasharray')) {
                    path.style.strokeDasharray = '8 4';
                    path.style.animation = 'dashFlow 2s linear infinite';
                }
            });
            
            // ä¸ºèŠ‚ç‚¹æ·»åŠ åŠ¨ç”»
            const nodes = svgElement.querySelectorAll('g.node');
            nodes.forEach(node => {
                const rect = node.querySelector('rect');
                if (rect) {
                    const fillColor = rect.getAttribute('fill') || '';
                    if (fillColor.includes('#dbeafe')) {
                        node.style.animation = 'pulse 2s infinite';
                    } else if (fillColor.includes('#dcfce7')) {
                        node.style.animation = 'bounceIn 0.6s ease-out';
                    }
                }
            });
        }
        
        // åˆå§‹æ¸²æŸ“
        renderDiagram();
    </script>
</body>
</html> 